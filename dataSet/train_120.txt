datetime                            2022-07-11 08:12:55-01:00
commit               038d5338530411bb47283fda1e84dec91137880b
repo                                               localstack
filepath                             localstack\aws\client.py
content     b'"""Utils to process AWS requests as a client...
methods                                      [parse_response]
lines       [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14...

1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 

"""Utils to process AWS requests as a client."""
from botocore.model import OperationModel
from botocore.parsers import create_parser as create_response_parser
from werkzeug import Response

from localstack.aws.api import ServiceResponse


def parse_response(operation: OperationModel, response: Response) -> ServiceResponse:
    """
    Parses an HTTP response object into an AWS response object using botocore.

    :param operation: the operation of the original request
    :param response: the HTTP response object containing the response of the operation
    :return: a parsed dictionary as it is returned by botocore
    """
    response_dict = {  # this is what botocore.endpoint.convert_to_response_dict normally does
        "headers": dict(response.headers.items()),  # boto doesn't like werkzeug headers
        "status_code": response.status_code,
        "body": response.data,
        "context": {
            "operation_name": operation.name,
        },
    }

    parser = create_response_parser(operation.service_model.protocol)
    return parser.parse(response_dict, operation.output_shape)
