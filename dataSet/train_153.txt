datetime                            2014-07-16 03:51:12-01:00
commit               0786e84a33155ebc8d8d3502e3a7f3060b86a4ec
repo                                                   scrapy
filepath                                   scrapy\utils\gz.py
content     b'import struct\n\ntry:\n    from cStringIO im...
methods                                              [gunzip]
lines                                  [2, 3, 4, 5, 6, 7, 15]

2 3 4 5 6 7 15 

import struct

try:
    from cStringIO import StringIO as BytesIO
except ImportError:
    from io import BytesIO

from gzip import GzipFile

def gunzip(data):
    """Gunzip the given data and return as much data as possible.

    This is resilient to CRC checksum errors.
    """
    f = GzipFile(fileobj=BytesIO(data))
    output = b''
    chunk = b'.'
    while chunk:
        try:
            chunk = f.read(8196)
            output += chunk
        except (IOError, EOFError, struct.error):
            # complete only if there is some data, otherwise re-raise
            # see issue 87 about catching struct.error
            # some pages are quite small so output is '' and f.extrabuf
            # contains the whole page content
            if output or f.extrabuf:
                output += f.extrabuf
                break
            else:
                raise
    return output

def is_gzipped(response):
    """Return True if the response is gzipped, or False otherwise"""
    ctype = response.headers.get('Content-Type', '')
    return ctype in ('application/x-gzip', 'application/gzip')
